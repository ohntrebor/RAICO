name: ü§ñ AI Review PR

on:
  pull_request:
    types: [opened, synchronize]

permissions:
  pull-requests: write
  contents: write

env:
  AI_PROVIDER: "openai"
  AI_MODEL: "gpt-3.5-turbo"
  AI_VERSION: ""
  PROMPT: |
    Voc√™ √© um especialista em revis√£o de c√≥digo para Pull Requests. Revise as altera√ß√µes de forma cr√≠tica e pr√°tica, focando em seguran√ßa, performance, legibilidade e manuten√ß√£o. Sua an√°lise deve:
      - Apresente apenas pontos que impactam seguran√ßa, performance, legibilidade ou manuten√ß√£o. Evite ao m√°ximo recomenda√ß√µes desnecess√°rias, se estiver tudo acerto, apenas diga que o PR est√° apto para o merge, e parabenize o autor.
      - Caso haja problemas criticos ou melhorias significativas, apenas cite, demonstrando como corrigir com exemplos de c√≥digo claros e curtos.
      - ‚ùå Rejeite o PR se houver problemas cr√≠ticos (bugs, seguran√ßa, erros graves). Explique claramente o problema, mostre o trecho problem√°tico e sugira uma corre√ß√£o com exemplo.
      - ‚ö†Ô∏è Aprove o PR com ressalvas se funcional, mas com melhorias poss√≠veis. D√™ sugest√µes objetivas para refinar o c√≥digo.
      - ‚úÖ Aprove o PR se estiver excelente, parabenize e destaque brevemente o que foi bem executado.



jobs:
  raico-review-pr:
    runs-on: ubuntu-latest

    steps:

      - name: ü§ñ Run Pull Request Review
        uses: ohntrebor/raico/.github/actions/review-pr@main
        with:
          ai_provider: ${{ env.AI_PROVIDER }} # No exemplo foi definida no pipe, mas pode cadastrar no seu reposit√≥rio se preferir
          ai_api_key: ${{ secrets.OPENAI_API_KEY }} # Cadastrar a API_KEY no secrests do seu reposit√≥rio
          ai_model: ${{ env.AI_MODEL }} # No exemplo foi definida no pipe, mas pode cadastrar no seu reposit√≥rio se preferir
          #ai_version: ${{ env.AI_VERSION }} # (opcional) dependendo da AI ser√° solicitado uma vers√£o
          github_token: ${{ secrets.GITHUB_TOKEN }} # O Github gere autom√°tico em pipelines, n√£o precisa gerar
          review_type: 2
          prompt: ${{ env.PROMPT }} # (opcional) Caso n√£o defina um prompt aqui, ser√° considerado o prompt default do reposit√≥rio RAICO

# review_type: 1 Review Files, √© um review por arquivos modificados, consome mais tokens por ser um review mais completo
# review_type: 2 Review Lines, √© um review por lonhas modificadas, consome menos tokens por ser um review menos completo 